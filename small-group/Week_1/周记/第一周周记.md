# 数据库连接池

## 优点

1. 提升系统性能：数据库连接建立和断开基于TCP协议，需要经过三次握手和四次挥手，将极大拉低系统响应速度！而连接池可以复用连接，控制建立和断开连接的次数
2. 便于管理连接：及时清除阻塞的连接，监控连接的健康情况和使用情况，可以避免一些损害数据库的危险因素

## 比较

> 市面上有许多现成的连接池，需要比较后进行技术选型

| 功能            | dbcp                | druid              | c3p0                               | tomcat-jdbc       | HikariCP                           |
| :-------------- | :------------------ | :----------------- | :--------------------------------- | :---------------- | :--------------------------------- |
| 是否支持PSCache | 是                  | 是                 | 是                                 | 否                | 否                                 |
| 监控            | jmx                 | jmx/log/http       | jmx,log                            | jmx               | jmx                                |
| 扩展性          | 弱                  | 好                 | 弱                                 | 弱                | 弱                                 |
| sql拦截及解析   | 无                  | 支持               | 无                                 | 无                | 无                                 |
| 代码            | 简单                | 中等               | 复杂                               | 简单              | 简单                               |
| 更新时间        | 2019.02             | 2019.05            | 2019.03                            |                   | 2019.02                            |
| 最新版本        | 2.60                | 1.1.17             | 0.9.5.4                            |                   | 3.3.1                              |
| 特点            | 依赖于common-pool   | 阿里开源，功能全面 | 历史久远，代码逻辑复杂，且不易维护 |                   | 优化力度大，功能简单，起源于boneCP |
| 连接池管理      | LinkedBlockingDeque | 数组               |                                    | FairBlockingQueue | threadlocal+CopyOnWriteArrayList   |

## 注意事项

1. 线程安全：为了能准确控制连接的建立和关闭，需要线程安全，诸如建立连接，归还连接等过程需要加锁确保原子性
2. 监控连接：要时常检查各连接的使用情况，剔除调不健康的连接